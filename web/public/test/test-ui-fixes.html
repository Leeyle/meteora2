<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¨ UIä¿®å¤æµ‹è¯•é¡µé¢</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        body {
            background-color: #1a1b2e;
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
        }

        .test-section {
            background: #16213e;
            border: 1px solid #0f3460;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .test-title {
            color: #ffffff;
            border-bottom: 2px solid #533483;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
    </style>
</head>

<body>
    <div class="container mt-4">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="test-section">
            <h1 class="text-center mb-3">ğŸ¨ UIä¿®å¤æµ‹è¯•é¡µé¢</h1>
            <p class="text-center text-muted">æµ‹è¯•æ¨¡æ€æ¡†å±…ä¸­ã€å–æ¶ˆåŠŸèƒ½å’Œå“åº”å¼å¸ƒå±€</p>
        </div>

        <!-- æµ‹è¯•æ§åˆ¶ -->
        <div class="test-section">
            <h3 class="test-title">ğŸ§ª æµ‹è¯•æ§åˆ¶</h3>
            <div class="row g-3">
                <div class="col-md-4">
                    <button class="btn btn-primary w-100" id="init-test-btn">
                        ğŸš€ åˆå§‹åŒ–æµ‹è¯•
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-success w-100" id="show-modal-btn" disabled>
                        ğŸ“ æ˜¾ç¤ºåˆ›å»ºè¡¨å•
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-warning w-100" id="test-responsive-btn">
                        ğŸ“± æµ‹è¯•å“åº”å¼
                    </button>
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•ç»“æœ -->
        <div class="test-section">
            <h3 class="test-title">ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="test-results">
                <div class="alert alert-info">
                    <strong>ç­‰å¾…æµ‹è¯•...</strong><br>
                    ç‚¹å‡»"åˆå§‹åŒ–æµ‹è¯•"å¼€å§‹
                </div>
            </div>
        </div>

        <!-- ç­–ç•¥ç®¡ç†å™¨å®¹å™¨ -->
        <div class="test-section">
            <h3 class="test-title">ğŸ¯ ç­–ç•¥ç®¡ç†å™¨é¢„è§ˆ</h3>
            <div id="strategy-test-container">
                <!-- ç­–ç•¥ç®¡ç†å™¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>
    </div>

    <!-- å¼•å…¥ä¿®å¤åçš„ç­–ç•¥æ¨¡å— -->
    <script src="../public/js/components/strategy/strategy-forms-simple.js"></script>
    <script src="../public/js/components/strategy/simple-y-manager.js"></script>

    <script>
        let testManager = null;
        let testResults = [];

        document.addEventListener('DOMContentLoaded', function () {
            console.log('ğŸ¨ UIä¿®å¤æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');

            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.getElementById('init-test-btn').addEventListener('click', initializeTest);
            document.getElementById('show-modal-btn').addEventListener('click', showModalTest);
            document.getElementById('test-responsive-btn').addEventListener('click', testResponsive);

            // ç›‘å¬ç­–ç•¥åˆ›å»ºäº‹ä»¶
            document.addEventListener('strategy-forms-createStrategy', function (e) {
                addTestResult('success', 'âœ… ç­–ç•¥åˆ›å»ºäº‹ä»¶', `ç­–ç•¥æ•°æ®æ”¶é›†æˆåŠŸ: ${e.detail.name}`);
            });
        });

        async function initializeTest() {
            try {
                addTestResult('info', 'ğŸš€ å¼€å§‹åˆå§‹åŒ–', 'æ­£åœ¨åˆ›å»ºç­–ç•¥ç®¡ç†å™¨å®ä¾‹...');

                // æ£€æŸ¥ç±»æ˜¯å¦åŠ è½½
                if (!window.SimpleYStrategyManager || !window.SimpleYStrategyForms) {
                    throw new Error('ç­–ç•¥æ¨¡å—æœªæ­£ç¡®åŠ è½½');
                }

                addTestResult('success', 'âœ… æ¨¡å—æ£€æŸ¥', 'æ‰€æœ‰ç­–ç•¥æ¨¡å—å·²æ­£ç¡®åŠ è½½');

                // åˆ›å»ºç®¡ç†å™¨å®ä¾‹
                testManager = new SimpleYStrategyManager('strategy-test-container');
                const success = await testManager.init();

                if (success) {
                    addTestResult('success', 'âœ… åˆå§‹åŒ–æˆåŠŸ', 'ç­–ç•¥ç®¡ç†å™¨åˆ›å»ºæˆåŠŸ');
                    document.getElementById('show-modal-btn').disabled = false;
                    document.getElementById('init-test-btn').disabled = true;

                    // æµ‹è¯•å¸ƒå±€
                    testLayout();
                } else {
                    throw new Error('ç­–ç•¥ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥');
                }

            } catch (error) {
                console.error('åˆå§‹åŒ–æµ‹è¯•å¤±è´¥:', error);
                addTestResult('danger', 'âŒ åˆå§‹åŒ–å¤±è´¥', error.message);
            }
        }

        function showModalTest() {
            try {
                addTestResult('info', 'ğŸ“ æ¨¡æ€æ¡†æµ‹è¯•', 'å°è¯•æ˜¾ç¤ºåˆ›å»ºç­–ç•¥è¡¨å•...');

                if (testManager && testManager.forms) {
                    testManager.showCreateStrategyForm();

                    // æ£€æŸ¥æ¨¡æ€æ¡†æ˜¯å¦æ­£ç¡®å±…ä¸­
                    setTimeout(() => {
                        const modal = document.getElementById('create-simple-y-modal');
                        if (modal && modal.style.display === 'flex') {
                            addTestResult('success', 'âœ… æ¨¡æ€æ¡†æ˜¾ç¤º', 'æ¨¡æ€æ¡†å·²æ­£ç¡®å±…ä¸­æ˜¾ç¤º');

                            // æµ‹è¯•å–æ¶ˆæŒ‰é’®
                            const cancelBtns = modal.querySelectorAll('button[onclick*="closest"]');
                            if (cancelBtns.length > 0) {
                                addTestResult('success', 'âœ… å–æ¶ˆæŒ‰é’®', `æ‰¾åˆ° ${cancelBtns.length} ä¸ªå–æ¶ˆæŒ‰é’®ï¼ŒåŠŸèƒ½æ­£å¸¸`);
                            } else {
                                addTestResult('warning', 'âš ï¸ å–æ¶ˆæŒ‰é’®', 'æœªæ‰¾åˆ°å–æ¶ˆæŒ‰é’®æˆ–ç»‘å®šå¼‚å¸¸');
                            }
                        } else {
                            addTestResult('danger', 'âŒ æ¨¡æ€æ¡†é—®é¢˜', 'æ¨¡æ€æ¡†æœªèƒ½æ­£ç¡®æ˜¾ç¤º');
                        }
                    }, 100);
                } else {
                    throw new Error('ç­–ç•¥ç®¡ç†å™¨æœªåˆå§‹åŒ–');
                }

            } catch (error) {
                addTestResult('danger', 'âŒ æ¨¡æ€æ¡†æµ‹è¯•å¤±è´¥', error.message);
            }
        }

        function testLayout() {
            addTestResult('info', 'ğŸ“ å¸ƒå±€æµ‹è¯•', 'æ£€æŸ¥å“åº”å¼å¸ƒå±€...');

            // æ£€æŸ¥ç»Ÿè®¡é¢æ¿
            const statsCards = document.querySelectorAll('.col-xl-3');
            if (statsCards.length === 4) {
                addTestResult('success', 'âœ… ç»Ÿè®¡é¢æ¿', 'å“åº”å¼æ …æ ¼å¸ƒå±€æ­£å¸¸ (4ä¸ªå¡ç‰‡)');
            } else {
                addTestResult('warning', 'âš ï¸ ç»Ÿè®¡é¢æ¿', `ç»Ÿè®¡å¡ç‰‡æ•°é‡å¼‚å¸¸: ${statsCards.length}`);
            }

            // æ£€æŸ¥è¡¨æ ¼
            const table = document.querySelector('.table-responsive table');
            if (table) {
                addTestResult('success', 'âœ… ç­–ç•¥è¡¨æ ¼', 'è¡¨æ ¼å“åº”å¼å¸ƒå±€æ­£å¸¸');
            } else {
                addTestResult('warning', 'âš ï¸ ç­–ç•¥è¡¨æ ¼', 'æœªæ‰¾åˆ°ç­–ç•¥è¡¨æ ¼');
            }
        }

        function testResponsive() {
            addTestResult('info', 'ğŸ“± å“åº”å¼æµ‹è¯•', 'æ¨¡æ‹Ÿä¸åŒå±å¹•å°ºå¯¸...');

            const container = document.getElementById('strategy-test-container');

            // æ¨¡æ‹Ÿç§»åŠ¨ç«¯
            container.style.width = '375px';
            addTestResult('info', 'ğŸ“± ç§»åŠ¨ç«¯æ¨¡æ‹Ÿ', 'åˆ‡æ¢åˆ°375pxå®½åº¦');

            setTimeout(() => {
                // æ¨¡æ‹Ÿå¹³æ¿
                container.style.width = '768px';
                addTestResult('info', 'ğŸ“± å¹³æ¿æ¨¡æ‹Ÿ', 'åˆ‡æ¢åˆ°768pxå®½åº¦');

                setTimeout(() => {
                    // æ¢å¤æ¡Œé¢ç«¯
                    container.style.width = '';
                    addTestResult('success', 'âœ… å“åº”å¼æµ‹è¯•', 'æ‰€æœ‰å±å¹•å°ºå¯¸æµ‹è¯•å®Œæˆ');
                }, 1000);
            }, 1000);
        }

        function addTestResult(type, title, message) {
            const alertClass = {
                'success': 'alert-success',
                'danger': 'alert-danger',
                'warning': 'alert-warning',
                'info': 'alert-info'
            }[type] || 'alert-info';

            const result = {
                type,
                title,
                message,
                time: new Date().toLocaleTimeString()
            };

            testResults.push(result);

            // æ›´æ–°æ˜¾ç¤º
            const resultsContainer = document.getElementById('test-results');
            resultsContainer.innerHTML = testResults.map(r => `
                <div class="alert ${alertClass} mb-2">
                    <strong>${r.title}</strong><br>
                    ${r.message}
                    <br><small class="text-muted">æ—¶é—´: ${r.time}</small>
                </div>
            `).join('');

            // æ»šåŠ¨åˆ°æœ€æ–°ç»“æœ
            resultsContainer.scrollTop = resultsContainer.scrollHeight;
        }

        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function (e) {
            addTestResult('danger', 'âŒ é¡µé¢é”™è¯¯', e.message);
        });

        // ç›‘å¬çª—å£è°ƒæ•´
        window.addEventListener('resize', function () {
            addTestResult('info', 'ğŸ“ çª—å£è°ƒæ•´', `æ–°å°ºå¯¸: ${window.innerWidth}x${window.innerHeight}`);
        });
    </script>
</body>

</html>