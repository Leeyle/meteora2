# 📊 数据分析功能使用指南

## 🎯 功能概述

数据分析功能为策略实例提供实时数据收集、存储和可视化分析。支持多种数据类型的分时图显示，包括策略生命周期管理和历史数据归档。

## 🚀 快速开始

### 1. 访问数据分析页面
- 在主界面左侧导航栏点击"数据分析"
- 系统会自动检测运行中的策略实例
- 首次使用时图表可能为空，等待策略产生数据

### 2. 数据类型选择
支持以下数据类型的实时监控：

- **📈 历史收益率** - 5分钟、15分钟、1小时的收益效率
- **🎯 活跃Bin百分比** - 当前价格在头寸范围内的位置
- **💰 价格变化** - 实时价格波动和历史变化
- **📊 净盈亏** - 策略的实时盈亏状况
- **💎 头寸价值** - 头寸总价值变化
- **💸 手续费数据** - 待提取和已提取的手续费

### 3. 时间范围切换
- **1小时** - 查看最近1小时的数据走势
- **4小时** - 查看最近4小时的数据走势（默认）
- **24小时** - 查看最近24小时的数据走势

## 🎛️ 控制面板功能

### 顶部按钮功能

1. **🔄 同步** - 手动同步策略状态，检测新启动或停止的策略
2. **🎯 演示数据** - 生成模拟数据用于功能演示
3. **🧪 测试图表** - 快速测试图表显示功能
4. **🧹 清除演示数据** - 清除所有演示数据，切换回真实数据收集
5. **⚙️ 设置** - 打开高级设置面板

### 数据源状态指示
系统状态显示区域会显示当前数据来源：
- **真实数据 - 等待策略更新** (绿色) - 正在收集策略实际数据
- **演示数据 - 模拟显示** (橙色) - 当前显示的是演示数据
- **测试数据 - 功能验证** (蓝色) - 当前显示的是测试数据

## 📊 图表区域

### 策略分类显示
策略按运行状态分为三个区域：

1. **🟢 活跃策略** - 正在运行的策略，实时更新数据
2. **🟡 已停止策略** - 已停止但保留历史数据的策略
3. **📁 归档策略** - 已归档的策略，可取消归档或永久删除

### 图表特性
- **自适应宽度** - 图表自动占满容器宽度
- **多数据叠加** - 在同一图表中显示多种数据类型
- **每行显示** - 每个策略实例的图表独占一行
- **实时更新** - 数据更新频率跟随现有系统频率（约30秒）

## 🔧 高级功能

### 策略生命周期管理

1. **自动状态同步** - 每30秒自动检测策略状态变化
2. **数据冻结** - 策略停止后数据自动冻结，不再更新
3. **手动归档** - 可手动将策略移至归档区域
4. **数据保留** - 策略删除后数据仍然保留，直到手动清理

### 数据存储管理

- **保留期设置** - 可设置数据保留3-7天
- **存储统计** - 查看数据库使用情况和统计信息
- **数据清理** - 支持选择性或批量清理历史数据

## 💡 使用技巧

### 演示和测试模式

1. **初次使用**：
   - 点击"🎯 演示数据"查看功能效果
   - 了解图表显示方式和数据类型

2. **功能验证**：
   - 点击"🧪 测试图表"验证图表渲染是否正常
   - 用于排查显示问题

3. **切换真实数据**：
   - 点击"🧹 清除演示数据"切换回真实数据收集
   - 系统会清除所有测试数据并重新开始收集

### 数据收集说明

- **实时收集** - 系统通过Socket.IO监听策略数据更新
- **数据验证** - 所有收集的数据都经过验证和标准化处理
- **断线恢复** - 网络断开重连后会自动恢复数据收集
- **多实例支持** - 支持同时监控多个策略实例

### 性能优化

- **数据点限制** - 每个图表自动限制数据点数量，保持流畅性能
- **渐进加载** - 历史数据分批加载，避免界面卡顿
- **内存管理** - 自动清理过期数据，释放浏览器内存

## 🔍 故障排除

### 图表不显示数据
1. 检查策略是否正在运行
2. 确认数据源状态（是否为演示数据）
3. 点击"🔄 同步"刷新策略状态
4. 使用"🧪 测试图表"验证图表功能

### 数据收集异常
1. 检查浏览器控制台错误信息
2. 确认Socket.IO连接状态
3. 重新刷新页面重置连接
4. 联系技术支持并提供控制台日志

### 性能问题
1. 减少选中的数据类型数量
2. 缩短时间范围（如从24小时改为4小时）
3. 清理归档的策略数据
4. 降低数据保留天数

## 📝 技术说明

### 数据流架构
```
策略实例 → Socket.IO → 数据收集器 → IndexedDB → 图表管理器 → Chart.js显示
```

### 存储机制
- 使用IndexedDB本地存储数据
- 支持时间范围查询和数据过期清理
- 数据结构标准化，便于分析和处理

### 实时更新
- 基于现有的Socket.IO事件系统
- 数据更新频率与策略监控一致
- 支持批量数据处理和图表优化更新

---

**注意**：首次使用建议先通过演示数据了解功能，然后切换回真实数据进行正常使用。 