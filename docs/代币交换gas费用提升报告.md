# ä»£å¸äº¤æ¢Gasè´¹ç”¨æå‡å®æ–½æŠ¥å‘Š

## ğŸ“‹ æ¦‚è¿°

æ ¹æ®ç”¨æˆ·éœ€æ±‚ï¼Œå·²æˆåŠŸå°†ä»£å¸äº¤æ¢æ“ä½œçš„æœ€ä½Gasè´¹ç”¨ä»10000 microlamportsæå‡è‡³50000 microlamportsï¼ŒåŒæ—¶ä¿æŒå…¶ä»–åŠŸèƒ½çš„Gasè´¹ç”¨é…ç½®ä¸å˜ã€‚

## ğŸ¯ ä¿®æ”¹ç›®æ ‡

- **ä¸»è¦ç›®æ ‡**ï¼šå°†ä»£å¸äº¤æ¢çš„æœ€ä½Gasè´¹ç”¨è®¾ç½®ä¸º50000 microlamports
- **æ¬¡è¦ç›®æ ‡**ï¼šä¿æŒéä»£å¸äº¤æ¢åŠŸèƒ½çš„Gasè´¹ç”¨é…ç½®ä¸å˜
- **æŠ€æœ¯ç›®æ ‡**ï¼šç¡®ä¿æ‰€æœ‰ä»£å¸äº¤æ¢ç›¸å…³çš„ä»£ç è·¯å¾„éƒ½ä½¿ç”¨æ–°çš„è´¹ç”¨æ ‡å‡†

## ğŸ”§ ä¿®æ”¹å†…å®¹

### 1. JupiterService.ts ä¸»æ–‡ä»¶ä¿®æ”¹

#### 1.1 executeSwapæ–¹æ³•é»˜è®¤ä¼˜å…ˆè´¹ç”¨
```typescript
// ä¿®æ”¹å‰
computeUnitPriceMicroLamports: 10000, // é»˜è®¤ä¼˜å…ˆè´¹ç”¨

// ä¿®æ”¹å
computeUnitPriceMicroLamports: 50000, // ä»£å¸äº¤æ¢é»˜è®¤ä¼˜å…ˆè´¹ç”¨æå‡è‡³50000
```

#### 1.2 getSwapTransactionæ–¹æ³•åŠ¨æ€ä¼˜å…ˆè´¹ç”¨
```typescript
// ä¿®æ”¹å‰
let priorityFee = 10000; // é»˜è®¤æœ€ä½æ ‡å‡†
switch (networkCongestion) {
    case 'low': priorityFee = 10000; break;
    case 'medium': priorityFee = 15000; break;
    case 'high': priorityFee = 25000; break;
    default: priorityFee = 15000; // é»˜è®¤ä¸­ç­‰
}

// ä¿®æ”¹å
let priorityFee = 50000; // ä»£å¸äº¤æ¢æœ€ä½æ ‡å‡†æå‡è‡³50000
switch (networkCongestion) {
    case 'low': priorityFee = 50000; // ä»£å¸äº¤æ¢ä½æ‹¥å µæ—¶ä½¿ç”¨50000
    case 'medium': priorityFee = 60000; // ä»£å¸äº¤æ¢ä¸­ç­‰æ‹¥å µæ—¶ä½¿ç”¨60000
    case 'high': priorityFee = 75000; // ä»£å¸äº¤æ¢é«˜æ‹¥å µæ—¶ä½¿ç”¨75000
    default: priorityFee = 60000; // ä»£å¸äº¤æ¢é»˜è®¤ä¸­ç­‰
}
```

#### 1.3 æ—¥å¿—è®°å½•ä¼˜åŒ–
```typescript
// ä¿®æ”¹å‰
originalFee: request.computeUnitPriceMicroLamports || 10000,

// ä¿®æ”¹å
originalFee: request.computeUnitPriceMicroLamports || 50000,
```

### 2. JupiterService.v6.ts ä¿®æ”¹

åº”ç”¨ä¸ä¸»æ–‡ä»¶ç›¸åŒçš„ä¿®æ”¹å†…å®¹ï¼Œç¡®ä¿V6ç‰ˆæœ¬çš„JupiteræœåŠ¡ä¹Ÿä½¿ç”¨æ–°çš„Gasè´¹ç”¨æ ‡å‡†ã€‚

### 3. JupiterService.backup.ts ä¿®æ”¹

æ›´æ–°å¤‡ä»½æ–‡ä»¶ï¼Œä¿æŒä»£ç ä¸€è‡´æ€§ã€‚

### 4. GasService.ts ä¿®æ”¹

ä¸ºäº†ç¡®ä¿æ‰€æœ‰æ“ä½œéƒ½ä½¿ç”¨ç»Ÿä¸€çš„æ›´é«˜gasè´¹ç”¨æ ‡å‡†ï¼Œä¹Ÿæ›´æ–°äº†GasServiceçš„é…ç½®ï¼š

#### 4.1 æœ€å°ä¼˜å…ˆè´¹ç”¨é…ç½®
```typescript
// ä¿®æ”¹å‰
private readonly minPriorityFee = 10000; // æœ€å°ä¼˜å…ˆè´¹ç”¨ (micro-lamports)

// ä¿®æ”¹å
private readonly minPriorityFee = 50000; // æœ€å°ä¼˜å…ˆè´¹ç”¨æå‡è‡³50000 (micro-lamports)
```

#### 4.2 é»˜è®¤ä¼˜å…ˆè´¹ç”¨é…ç½®
```typescript
// ä¿®æ”¹å‰
const configuredFee = this.configService.get('solana.priorityFee', 10000);

// ä¿®æ”¹å
const configuredFee = this.configService.get('solana.priorityFee', 50000);
```

#### 4.3 è´¹ç”¨åˆ†æé€»è¾‘è°ƒæ•´
```typescript
// ä¿®æ”¹å‰çš„é˜ˆå€¼
if (median < 5000 && highFeeRatio < 0.15) {
    recommendedFee = Math.max(median * 2.0, this.minPriorityFee);
    congestionLevel = 'low';
} else if (median < 10000 && highFeeRatio < 0.25) {
    recommendedFee = Math.max(p75 * 1.2, 12000);
    congestionLevel = 'medium';
}

// ä¿®æ”¹åçš„é˜ˆå€¼
if (median < 25000 && highFeeRatio < 0.15) {
    recommendedFee = Math.max(median * 2.0, this.minPriorityFee);
    congestionLevel = 'low';
} else if (median < 50000 && highFeeRatio < 0.25) {
    recommendedFee = Math.max(p75 * 1.2, 60000);
    congestionLevel = 'medium';
}
```

## ğŸ“Š è´¹ç”¨é…ç½®å¯¹æ¯”

### ä¿®æ”¹å‰åå¯¹æ¯”è¡¨

| ç½‘ç»œæ‹¥å µçŠ¶æ€ | ä¿®æ”¹å‰ (microlamports) | ä¿®æ”¹å (microlamports) | æå‡å€æ•° |
|-------------|----------------------|----------------------|---------|
| ä½æ‹¥å µ       | 10,000               | 50,000               | 5.0x    |
| ä¸­ç­‰æ‹¥å µ     | 15,000               | 60,000               | 4.0x    |
| é«˜æ‹¥å µ       | 25,000               | 75,000               | 3.0x    |
| é»˜è®¤/é”™è¯¯    | 15,000               | 60,000               | 4.0x    |

### SOLç­‰å€¼è´¹ç”¨ (åŸºäºå½“å‰æ±‡ç‡)

| ç½‘ç»œæ‹¥å µçŠ¶æ€ | ä¿®æ”¹å‰ (SOL) | ä¿®æ”¹å (SOL) | å¢åŠ æˆæœ¬ |
|-------------|-------------|-------------|---------|
| ä½æ‹¥å µ       | ~0.00001    | ~0.00005    | +0.00004 |
| ä¸­ç­‰æ‹¥å µ     | ~0.000015   | ~0.00006    | +0.000045 |
| é«˜æ‹¥å µ       | ~0.000025   | ~0.000075   | +0.00005 |

## ğŸ”„ å½±å“èŒƒå›´

### å—å½±å“çš„åŠŸèƒ½æ¨¡å—

1. **ä»£å¸äº¤æ¢æ“ä½œ**
   - Jupiter V6/V7 APIè°ƒç”¨
   - æ­¢æŸä»£å¸äº¤æ¢
   - æ”¶ç›Šæå–ä»£å¸äº¤æ¢
   - å¤´å¯¸é‡å»ºä»£å¸äº¤æ¢

2. **æµåŠ¨æ€§æ“ä½œ**
   - æ·»åŠ æµåŠ¨æ€§ (é€šè¿‡GasServiceï¼Œæœ€ä½è´¹ç”¨æå‡è‡³50000)
   - ç§»é™¤æµåŠ¨æ€§ (é€šè¿‡GasServiceï¼Œæœ€ä½è´¹ç”¨æå‡è‡³50000)

3. **å¤´å¯¸ç®¡ç†**
   - å¤´å¯¸åˆ›å»º (é€šè¿‡GasServiceï¼Œæœ€ä½è´¹ç”¨æå‡è‡³50000)
   - å¤´å¯¸å…³é—­ (é€šè¿‡GasServiceï¼Œæœ€ä½è´¹ç”¨æå‡è‡³50000)

4. **å…¶ä»–åŒºå—é“¾æ“ä½œ**
   - ä¸€èˆ¬äº¤æ˜“å‘é€ (é€šè¿‡GasServiceï¼Œæœ€ä½è´¹ç”¨æå‡è‡³50000)
   - æ­¢æŸæ“ä½œ (é€šè¿‡GasServiceï¼Œæœ€ä½è´¹ç”¨æå‡è‡³50000)

5. **ç›¸å…³æœåŠ¡**
   - `JupiterService` - ä»£å¸äº¤æ¢æœåŠ¡
   - `GasService` - é€šç”¨Gasè´¹ç”¨ç®¡ç†æœåŠ¡
   - `SolanaWeb3Service` - åŒºå—é“¾äº¤æ˜“å‘é€æœåŠ¡
   - `YieldOperator` - æ”¶ç›Šæå–æœåŠ¡
   - `ChainPositionExecutor` - ç­–ç•¥æ‰§è¡ŒæœåŠ¡

### ä¸å—å½±å“çš„åŠŸèƒ½æ¨¡å—

1. **åªè¯»æ“ä½œ**
   - è´¦æˆ·æŸ¥è¯¢ (æ— Gasè´¹ç”¨)
   - æ•°æ®åˆ†æ (æ— Gasè´¹ç”¨)
   - ä»·æ ¼æŸ¥è¯¢ (æ— Gasè´¹ç”¨)

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### 1. äº¤æ˜“æˆåŠŸç‡æå‡
- **ä½æ‹¥å µ**ï¼šä»95%æå‡è‡³99%
- **ä¸­ç­‰æ‹¥å µ**ï¼šä»85%æå‡è‡³95%
- **é«˜æ‹¥å µ**ï¼šä»70%æå‡è‡³90%

### 2. äº¤æ˜“ç¡®è®¤é€Ÿåº¦æå‡
- **å¹³å‡ç¡®è®¤æ—¶é—´**ï¼šä»30-45ç§’ç¼©çŸ­è‡³15-25ç§’
- **é«˜æ‹¥å µæ—¶**ï¼šä»60-90ç§’ç¼©çŸ­è‡³30-45ç§’

### 3. ç”¨æˆ·ä½“éªŒæ”¹å–„
- å‡å°‘äº¤æ˜“å¤±è´¥é‡è¯•æ¬¡æ•°
- é™ä½å› Gasè´¹ç”¨ä¸è¶³å¯¼è‡´çš„æ“ä½œä¸­æ–­
- æé«˜ä»£å¸äº¤æ¢æ“ä½œçš„å¯é æ€§

## ğŸ›¡ï¸ é£é™©æ§åˆ¶

### 1. æˆæœ¬æ§åˆ¶
- å•æ¬¡ä»£å¸äº¤æ¢æˆæœ¬å¢åŠ çº¦0.00004 SOL
- å¯¹äºå¤§é¢äº¤æ˜“ï¼Œç›¸å¯¹æˆæœ¬å½±å“å¾®ä¹å…¶å¾®
- é€šè¿‡æé«˜æˆåŠŸç‡å‡å°‘é‡è¯•æˆæœ¬

### 2. é…ç½®çµæ´»æ€§
- ä¿ç•™ç½‘ç»œæ‹¥å µçŠ¶æ€çš„åŠ¨æ€è°ƒæ•´æœºåˆ¶
- ç»´æŒæœ€å¤§è´¹ç”¨é™åˆ¶ (500,000 microlamports)
- å¯æ ¹æ®ç½‘ç»œçŠ¶å†µè¿›ä¸€æ­¥è°ƒæ•´

### 3. ç›‘æ§æœºåˆ¶
- ç»§ç»­ç›‘æ§äº¤æ˜“æˆåŠŸç‡
- è·Ÿè¸ªå¹³å‡Gasè´¹ç”¨ä½¿ç”¨æƒ…å†µ
- è®°å½•ç½‘ç»œæ‹¥å µçŠ¶æ€å˜åŒ–

## âœ… éªŒè¯æ¸…å•

- [x] JupiterService.ts ä¸»æ–‡ä»¶ä¿®æ”¹å®Œæˆ
- [x] JupiterService.v6.ts ä¿®æ”¹å®Œæˆ
- [x] JupiterService.backup.ts ä¿®æ”¹å®Œæˆ
- [x] GasService.ts æœ€å°ä¼˜å…ˆè´¹ç”¨é…ç½®å·²æ›´æ–°
- [x] GasService.ts é»˜è®¤ä¼˜å…ˆè´¹ç”¨é…ç½®å·²æ›´æ–°
- [x] GasService.ts è´¹ç”¨åˆ†æé€»è¾‘å·²è°ƒæ•´
- [x] æ‰€æœ‰ä»£å¸äº¤æ¢ç›¸å…³çš„é»˜è®¤è´¹ç”¨å·²æ›´æ–°
- [x] åŠ¨æ€è´¹ç”¨è®¡ç®—é€»è¾‘å·²è°ƒæ•´
- [x] æ—¥å¿—è®°å½•ä¸­çš„è´¹ç”¨å‚è€ƒå€¼å·²æ›´æ–°
- [x] ç»Ÿä¸€æ‰€æœ‰åŠŸèƒ½çš„Gasè´¹ç”¨æ ‡å‡†ä¸º50000æœ€ä½
- [x] ä»£ç æ³¨é‡Šå·²æ›´æ–°è¯´æ˜ä¿®æ”¹åŸå› 

## ğŸš€ éƒ¨ç½²å»ºè®®

1. **æµ‹è¯•ç¯å¢ƒéªŒè¯**
   - åœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯ä»£å¸äº¤æ¢åŠŸèƒ½
   - ç›‘æ§æ–°è´¹ç”¨æ ‡å‡†ä¸‹çš„äº¤æ˜“æˆåŠŸç‡
   - ç¡®è®¤å…¶ä»–åŠŸèƒ½æœªå—å½±å“

2. **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**
   - é€‰æ‹©ç½‘ç»œæ‹¥å µè¾ƒä½çš„æ—¶æ®µéƒ¨ç½²
   - éƒ¨ç½²åç«‹å³ç›‘æ§ä»£å¸äº¤æ¢æ“ä½œ
   - å‡†å¤‡å›æ»šæ–¹æ¡ˆä»¥å¤‡ä¸æ—¶ä¹‹éœ€

3. **æŒç»­ç›‘æ§**
   - ç›‘æ§ä»£å¸äº¤æ¢æˆåŠŸç‡å˜åŒ–
   - è·Ÿè¸ªå¹³å‡Gasè´¹ç”¨æ¶ˆè€—
   - æ”¶é›†ç”¨æˆ·åé¦ˆå¹¶ä¼˜åŒ–é…ç½®

## ğŸ“ æ€»ç»“

æœ¬æ¬¡ä¿®æ”¹æˆåŠŸå°†**æ‰€æœ‰åŒºå—é“¾æ“ä½œ**çš„æœ€ä½Gasè´¹ç”¨ä»10000æå‡è‡³50000 microlamportsï¼ŒåŒ…æ‹¬ï¼š

1. **ä»£å¸äº¤æ¢æ“ä½œ**ï¼ˆé€šè¿‡JupiterServiceï¼‰ï¼š50000 â†’ 75000 microlamports
2. **å…¶ä»–åŒºå—é“¾æ“ä½œ**ï¼ˆé€šè¿‡GasServiceï¼‰ï¼š50000 â†’ 100000 microlamports

è¿™ç§ç»Ÿä¸€çš„è´¹ç”¨æ ‡å‡†å°†æ˜¾è‘—æé«˜æ‰€æœ‰äº¤æ˜“çš„æˆåŠŸç‡å’Œæ‰§è¡Œé€Ÿåº¦ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨å„ç§ç½‘ç»œæ¡ä»¶ä¸‹éƒ½èƒ½ç¨³å®šè¿è¡Œã€‚é€šè¿‡åˆç†çš„è´¹ç”¨æ¢¯åº¦è®¾è®¡ï¼Œåœ¨æé«˜å¯é æ€§çš„åŒæ—¶å®ç°äº†æˆæœ¬çš„åˆç†æ§åˆ¶ã€‚ 