# ğŸ—ï¸ å¤´å¯¸é‡å»ºè‡ªå®šä¹‰å‚æ•°é…ç½®åŠŸèƒ½å®ç°æŠ¥å‘Š

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å®ç°äº†åœ¨å‰ç«¯åˆ›å»ºè¿é”å¤´å¯¸ç­–ç•¥æ—¶ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©å¯ç”¨/ç¦ç”¨æ–¹æ³•2å’Œæ–¹æ³•3ï¼Œå¹¶æ”¯æŒè‡ªå®šä¹‰å„ç§é˜ˆå€¼å‚æ•°çš„åŠŸèƒ½ã€‚è¿™ä¸ªåŠŸèƒ½è®©ç”¨æˆ·èƒ½å¤Ÿæ ¹æ®è‡ªå·±çš„é£é™©åå¥½å’Œäº¤æ˜“ç­–ç•¥æ¥è°ƒæ•´æ™ºèƒ½é‡å»ºçš„è§¦å‘æ¡ä»¶ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. **æ–¹æ³•2ï¼šæ™ºèƒ½å¤´å¯¸é‡å»º**
- **å¯ç”¨å¼€å…³**ï¼šç”¨æˆ·å¯é€‰æ‹©æ˜¯å¦å¯ç”¨
- **è‡ªå®šä¹‰å‚æ•°**ï¼š
  - æ´»è·ƒbinä½ç½®é˜ˆå€¼ï¼ˆé»˜è®¤70%ï¼‰
  - ç›ˆåˆ©é˜ˆå€¼ï¼ˆé»˜è®¤1%ï¼‰

### 2. **æ–¹æ³•3ï¼šæ­¢æŸååå¼¹é‡å»º**
- **å¯ç”¨å¼€å…³**ï¼šç”¨æˆ·å¯é€‰æ‹©æ˜¯å¦å¯ç”¨
- **è‡ªå®šä¹‰å‚æ•°**ï¼š
  - æ ‡è®°æ—¶ä½ç½®é˜ˆå€¼ï¼ˆé»˜è®¤65%ï¼‰
  - æ ‡è®°æ—¶äºæŸé˜ˆå€¼ï¼ˆé»˜è®¤0.5%ï¼‰
  - è§¦å‘æ—¶ä½ç½®é˜ˆå€¼ï¼ˆé»˜è®¤70%ï¼‰
  - è§¦å‘æ—¶ç›ˆåˆ©é˜ˆå€¼ï¼ˆé»˜è®¤0.5%ï¼‰

## ğŸ”§ æŠ€æœ¯å®ç°

### å‰ç«¯å®ç°

#### 1. **è¡¨å•é…ç½®**
åœ¨ `ChainPositionCreator.js` ä¸­æ·»åŠ äº†å®Œæ•´çš„å¤´å¯¸é‡å»ºé…ç½®UIï¼š

```javascript
// ğŸ—ï¸ å¤´å¯¸é‡å»ºé…ç½®
positionRecreation: {
    enableMarketOpportunityRecreation: true,  // æ–¹æ³•2ï¼šæ™ºèƒ½å¤´å¯¸é‡å»º
    marketOpportunity: {
        positionThreshold: 70,    // æ´»è·ƒbinä½ç½®é˜ˆå€¼(%)
        profitThreshold: 1        // ç›ˆåˆ©é˜ˆå€¼(%)
    },
    enableLossRecoveryRecreation: true,       // æ–¹æ³•3ï¼šæ­¢æŸååå¼¹é‡å»º
    lossRecovery: {
        markPositionThreshold: 65,    // æ ‡è®°æ—¶ä½ç½®é˜ˆå€¼(%)
        markLossThreshold: 0.5,       // æ ‡è®°æ—¶äºæŸé˜ˆå€¼(%)
        triggerPositionThreshold: 70, // è§¦å‘æ—¶ä½ç½®é˜ˆå€¼(%)
        triggerProfitThreshold: 0.5   // è§¦å‘æ—¶ç›ˆåˆ©é˜ˆå€¼(%)
    }
}
```

#### 2. **ç”¨æˆ·ç•Œé¢**
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¯ä¸ªæ–¹æ³•æœ‰ç‹¬ç«‹çš„é…ç½®åŒºåŸŸ
- **å¼€å…³æ§åˆ¶**ï¼šå¯ç”¨å¼€å…³æ§åˆ¶è¯¦ç»†å‚æ•°çš„æ˜¾ç¤º/éšè—
- **å‚æ•°éªŒè¯**ï¼šè¾“å…¥èŒƒå›´éªŒè¯å’Œå®æ—¶éªŒè¯
- **ç”¨æˆ·å‹å¥½**ï¼šæ¯ä¸ªå‚æ•°éƒ½æœ‰è¯¦ç»†çš„è¯´æ˜æ–‡å­—

#### 3. **äº‹ä»¶å¤„ç†**
```javascript
// ğŸ—ï¸ å¤´å¯¸é‡å»ºé…ç½®å¼€å…³
const enableMarketOpportunity = this.container.querySelector('[data-field="positionRecreation.enableMarketOpportunityRecreation"]');
if (enableMarketOpportunity) {
    enableMarketOpportunity.addEventListener('change', (e) => {
        const details = document.getElementById('marketOpportunityDetails');
        if (details) {
            details.style.display = e.target.checked ? 'block' : 'none';
        }
    });
}
```

### åç«¯å®ç°

#### 1. **é…ç½®æ¥å£æ‰©å±•**

æ›´æ–°äº† `ChainPositionConfig` æ¥å£ï¼š
```typescript
// ğŸ—ï¸ å¤´å¯¸é‡å»ºé…ç½®
positionRecreation?: {
    enableMarketOpportunityRecreation?: boolean;    // æ–¹æ³•2ï¼šæ™ºèƒ½å¤´å¯¸é‡å»º
    enableLossRecoveryRecreation?: boolean;         // æ–¹æ³•3ï¼šæ­¢æŸååå¼¹é‡å»º
    marketOpportunity?: {
        positionThreshold?: number;      // æ´»è·ƒbinä½ç½®é˜ˆå€¼(%)ï¼Œé»˜è®¤70
        profitThreshold?: number;        // ç›ˆåˆ©é˜ˆå€¼(%)ï¼Œé»˜è®¤1
    };
    lossRecovery?: {
        markPositionThreshold?: number;      // æ ‡è®°æ—¶ä½ç½®é˜ˆå€¼(%)ï¼Œé»˜è®¤65
        markLossThreshold?: number;          // æ ‡è®°æ—¶äºæŸé˜ˆå€¼(%)ï¼Œé»˜è®¤0.5
        triggerPositionThreshold?: number;   // è§¦å‘æ—¶ä½ç½®é˜ˆå€¼(%)ï¼Œé»˜è®¤70
        triggerProfitThreshold?: number;     // è§¦å‘æ—¶ç›ˆåˆ©é˜ˆå€¼(%)ï¼Œé»˜è®¤0.5
    };
};
```

#### 2. **é‡å»ºæ¨¡å—é…ç½®**

æ›´æ–°äº† `PositionRecreationConfig` æ¥å£ï¼š
```typescript
// ğŸ—ï¸ æ–¹æ³•2ï¼šæ™ºèƒ½å¤´å¯¸é‡å»ºè‡ªå®šä¹‰å‚æ•°
marketOpportunity?: {
    positionThreshold: number;       // æ´»è·ƒbinä½ç½®é˜ˆå€¼(%)ï¼Œé»˜è®¤70
    profitThreshold: number;         // ç›ˆåˆ©é˜ˆå€¼(%)ï¼Œé»˜è®¤1
};

// ğŸš€ æ–¹æ³•3ï¼šæ­¢æŸååå¼¹é‡å»ºè‡ªå®šä¹‰å‚æ•°
lossRecovery?: {
    markPositionThreshold: number;       // æ ‡è®°æ—¶ä½ç½®é˜ˆå€¼(%)ï¼Œé»˜è®¤65
    markLossThreshold: number;           // æ ‡è®°æ—¶äºæŸé˜ˆå€¼(%)ï¼Œé»˜è®¤0.5
    triggerPositionThreshold: number;    // è§¦å‘æ—¶ä½ç½®é˜ˆå€¼(%)ï¼Œé»˜è®¤70
    triggerProfitThreshold: number;      // è§¦å‘æ—¶ç›ˆåˆ©é˜ˆå€¼(%)ï¼Œé»˜è®¤0.5
};
```

#### 3. **æ‰§è¡Œå™¨é›†æˆ**

åœ¨ `ChainPositionExecutor` ä¸­å®ç°é…ç½®ä¼ é€’ï¼š
```typescript
// ğŸ”¥ é…ç½®å¤´å¯¸é‡å»ºæ¨¡å—å‚æ•°
const positionRecreationConfig = state.config.positionRecreation || {};

const recreationConfig: Partial<PositionRecreationConfig> = {
    // ğŸ—ï¸ ä»å‰ç«¯é…ç½®è¯»å–æ–¹æ³•2å’Œæ–¹æ³•3çš„å¯ç”¨çŠ¶æ€
    enableMarketOpportunityRecreation: positionRecreationConfig.enableMarketOpportunityRecreation ?? true,
    enableLossRecoveryRecreation: positionRecreationConfig.enableLossRecoveryRecreation ?? true,
    
    // ğŸ—ï¸ æ–¹æ³•2è‡ªå®šä¹‰å‚æ•°
    marketOpportunity: {
        positionThreshold: positionRecreationConfig.marketOpportunity?.positionThreshold ?? 70,
        profitThreshold: positionRecreationConfig.marketOpportunity?.profitThreshold ?? 1
    },
    
    // ğŸš€ æ–¹æ³•3è‡ªå®šä¹‰å‚æ•°
    lossRecovery: {
        markPositionThreshold: positionRecreationConfig.lossRecovery?.markPositionThreshold ?? 65,
        markLossThreshold: positionRecreationConfig.lossRecovery?.markLossThreshold ?? 0.5,
        triggerPositionThreshold: positionRecreationConfig.lossRecovery?.triggerPositionThreshold ?? 70,
        triggerProfitThreshold: positionRecreationConfig.lossRecovery?.triggerProfitThreshold ?? 0.5
    }
};
```

#### 4. **å†³ç­–é€»è¾‘æ›´æ–°**

**æ–¹æ³•2å®ç°**ï¼š
```typescript
// ğŸ—ï¸ è·å–é…ç½®å‚æ•°ï¼ˆä½¿ç”¨é…ç½®æˆ–é»˜è®¤å€¼ï¼‰
const positionThreshold = this.config.marketOpportunity?.positionThreshold || 70;
const profitThreshold = this.config.marketOpportunity?.profitThreshold || 1;

// ğŸ”¥ æ™ºèƒ½é‡å»ºæ¡ä»¶1ï¼šæ´»è·ƒbinä½ç½®ä½äºé…ç½®é˜ˆå€¼
const isPositionBelowThreshold = positionPercentage < positionThreshold;

// ğŸ”¥ æ™ºèƒ½é‡å»ºæ¡ä»¶2ï¼šç›ˆäºç™¾åˆ†æ¯”å¤§äºé…ç½®é˜ˆå€¼
const isPnLAboveThreshold = marketData.netPnLPercentage > profitThreshold;
```

**æ–¹æ³•3å®ç°**ï¼š
```typescript
// ğŸ—ï¸ è·å–é…ç½®å‚æ•°ï¼ˆä½¿ç”¨é…ç½®æˆ–é»˜è®¤å€¼ï¼‰
const markPositionThreshold = this.config.lossRecovery?.markPositionThreshold || 65;
const markLossThreshold = this.config.lossRecovery?.markLossThreshold || 0.5;
const triggerPositionThreshold = this.config.lossRecovery?.triggerPositionThreshold || 70;
const triggerProfitThreshold = this.config.lossRecovery?.triggerProfitThreshold || 0.5;
```

## ğŸ“Š ç”¨æˆ·ä½“éªŒ

### 1. **ç›´è§‚çš„é…ç½®ç•Œé¢**
- **åˆ†ç»„æ˜¾ç¤º**ï¼šæ–¹æ³•2å’Œæ–¹æ³•3åˆ†åˆ«åœ¨ç‹¬ç«‹åŒºåŸŸ
- **å¼€å…³æ§åˆ¶**ï¼šå¯ç”¨åæ‰æ˜¾ç¤ºè¯¦ç»†å‚æ•°
- **å‚æ•°è¯´æ˜**ï¼šæ¯ä¸ªå‚æ•°éƒ½æœ‰è¯¦ç»†çš„å¸®åŠ©æ–‡æœ¬
- **èŒƒå›´é™åˆ¶**ï¼šè¾“å…¥æ¡†æœ‰åˆç†çš„æœ€å°å€¼å’Œæœ€å¤§å€¼é™åˆ¶

### 2. **çµæ´»çš„å‚æ•°è°ƒæ•´**
- **ä½ç½®é˜ˆå€¼**ï¼š1-99%å¯è°ƒèŠ‚
- **ç›ˆäºé˜ˆå€¼**ï¼š0.1-10%å¯è°ƒèŠ‚
- **å®æ—¶éªŒè¯**ï¼šè¾“å…¥æ—¶ç«‹å³éªŒè¯å‚æ•°æœ‰æ•ˆæ€§

### 3. **é»˜è®¤é…ç½®åˆç†**
- **æ–¹æ³•2**ï¼š70%ä½ç½® + 1%ç›ˆåˆ©ï¼ˆå¹³è¡¡ç­–ç•¥ï¼‰
- **æ–¹æ³•3**ï¼š65%æ ‡è®°äºæŸ + 70%è§¦å‘ä½ç½® + 0.5%é˜ˆå€¼ï¼ˆä¿å®ˆç­–ç•¥ï¼‰

## ğŸ” éªŒè¯ä¸æµ‹è¯•

### 1. **ç¼–è¯‘éªŒè¯**
```bash
npm run build
# âœ… ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯
```

### 2. **é…ç½®æµéªŒè¯**
1. **å‰ç«¯è¡¨å•** â†’ æäº¤ç­–ç•¥é…ç½®
2. **åç«¯æ¥æ”¶** â†’ è§£æå¤´å¯¸é‡å»ºé…ç½®
3. **æ‰§è¡Œå™¨ä¼ é€’** â†’ é…ç½®ä¼ é€’ç»™é‡å»ºæ¨¡å—
4. **å†³ç­–é€»è¾‘** â†’ ä½¿ç”¨è‡ªå®šä¹‰å‚æ•°è¿›è¡Œåˆ¤æ–­

### 3. **å‘åå…¼å®¹æ€§**
- **æ—§é…ç½®**ï¼šæ²¡æœ‰å¤´å¯¸é‡å»ºé…ç½®çš„ç­–ç•¥ä»ä½¿ç”¨é»˜è®¤å‚æ•°
- **ç¼ºå¤±å‚æ•°**ï¼šä½¿ç”¨ `??` æ“ä½œç¬¦ç¡®ä¿é»˜è®¤å€¼ç”Ÿæ•ˆ
- **ç±»å‹å®‰å…¨**ï¼šæ‰€æœ‰å‚æ•°éƒ½æœ‰æ­£ç¡®çš„TypeScriptç±»å‹å®šä¹‰

## ğŸ¯ æŠ€æœ¯ä¼˜åŠ¿

### 1. **æ¨¡å—åŒ–è®¾è®¡**
- **å‰åç«¯åˆ†ç¦»**ï¼šé…ç½®åœ¨å‰ç«¯å®šä¹‰ï¼Œåç«¯æ‰§è¡Œ
- **æ¥å£æ¸…æ™°**ï¼šé…ç½®ç»“æ„å±‚æ¬¡åˆ†æ˜ï¼Œæ˜“äºç†è§£
- **æ‰©å±•æ€§å¼º**ï¼šæœªæ¥å¯è½»æ¾æ·»åŠ æ›´å¤šè‡ªå®šä¹‰å‚æ•°

### 2. **ç”¨æˆ·å‹å¥½**
- **æ‰€è§å³æ‰€å¾—**ï¼šå¼€å…³æ§åˆ¶é…ç½®é¡¹æ˜¾ç¤º
- **å‚æ•°éªŒè¯**ï¼šé˜²æ­¢ç”¨æˆ·è¾“å…¥æ— æ•ˆå€¼
- **åˆç†é»˜è®¤å€¼**ï¼šå³ä½¿ä¸è‡ªå®šä¹‰ä¹Ÿæœ‰è‰¯å¥½çš„æ•ˆæœ

### 3. **ç³»ç»Ÿç¨³å®šæ€§**
- **å‘ä¸‹å…¼å®¹**ï¼šä¸å½±å“ç°æœ‰åŠŸèƒ½
- **é”™è¯¯å¤„ç†**ï¼šå‚æ•°ç¼ºå¤±æ—¶æœ‰åˆç†çš„é»˜è®¤å€¼
- **ç±»å‹å®‰å…¨**ï¼šTypeScriptç¡®ä¿ç±»å‹æ­£ç¡®æ€§

## ğŸ“ ä½¿ç”¨æŒ‡å—

### 1. **å¯ç”¨æ–¹æ³•2ï¼ˆæ™ºèƒ½å¤´å¯¸é‡å»ºï¼‰**
1. å‹¾é€‰"å¯ç”¨æ™ºèƒ½å¤´å¯¸é‡å»º"
2. è°ƒæ•´æ´»è·ƒbinä½ç½®é˜ˆå€¼ï¼ˆæ¨è60-80%ï¼‰
3. è°ƒæ•´ç›ˆåˆ©é˜ˆå€¼ï¼ˆæ¨è0.5-2%ï¼‰

### 2. **å¯ç”¨æ–¹æ³•3ï¼ˆæ­¢æŸååå¼¹é‡å»ºï¼‰**
1. å‹¾é€‰"å¯ç”¨æ­¢æŸååå¼¹é‡å»º"
2. è®¾ç½®æ ‡è®°æ¡ä»¶ï¼šä½ç½®é˜ˆå€¼å’ŒäºæŸé˜ˆå€¼
3. è®¾ç½®è§¦å‘æ¡ä»¶ï¼šä½ç½®é˜ˆå€¼å’Œç›ˆåˆ©é˜ˆå€¼

### 3. **å‚æ•°è°ƒæ•´å»ºè®®**
- **ä¿å®ˆç­–ç•¥**ï¼šæé«˜ä½ç½®é˜ˆå€¼ï¼Œé™ä½ç›ˆäºé˜ˆå€¼
- **æ¿€è¿›ç­–ç•¥**ï¼šé™ä½ä½ç½®é˜ˆå€¼ï¼Œæé«˜ç›ˆäºé˜ˆå€¼
- **å¹³è¡¡ç­–ç•¥**ï¼šä½¿ç”¨é»˜è®¤å‚æ•°

## âœ… å®ŒæˆçŠ¶æ€

- âœ… **å‰ç«¯UIå®ç°**ï¼šå®Œæ•´çš„é…ç½®ç•Œé¢
- âœ… **åç«¯æ¥å£**ï¼šé…ç½®ç»“æ„å®šä¹‰
- âœ… **æ‰§è¡Œå™¨é›†æˆ**ï¼šé…ç½®ä¼ é€’é€»è¾‘
- âœ… **å†³ç­–é€»è¾‘**ï¼šä½¿ç”¨è‡ªå®šä¹‰å‚æ•°
- âœ… **ç±»å‹å®šä¹‰**ï¼šTypeScriptç±»å‹å®‰å…¨
- âœ… **ç¼–è¯‘éªŒè¯**ï¼šæ— é”™è¯¯ç¼–è¯‘é€šè¿‡
- âœ… **å‘åå…¼å®¹**ï¼šæ—§é…ç½®ä»å¯æ­£å¸¸å·¥ä½œ

## ğŸš€ åŠŸèƒ½æ•ˆæœ

### 1. **ç”¨æˆ·æ§åˆ¶å¢å¼º**
ç”¨æˆ·ç°åœ¨å¯ä»¥æ ¹æ®è‡ªå·±çš„äº¤æ˜“ç­–ç•¥å’Œé£é™©åå¥½ï¼Œç²¾ç¡®è°ƒæ•´å¤´å¯¸é‡å»ºçš„è§¦å‘æ¡ä»¶ã€‚

### 2. **çµæ´»æ€§æå‡**
ä¸å†å±€é™äºç¡¬ç¼–ç çš„70%ã€1%ç­‰å‚æ•°ï¼Œç”¨æˆ·å¯ä»¥åœ¨åˆç†èŒƒå›´å†…è‡ªç”±è°ƒæ•´ã€‚

### 3. **ç­–ç•¥å¤šæ ·åŒ–**
æ”¯æŒä¿å®ˆã€å¹³è¡¡ã€æ¿€è¿›ç­‰ä¸åŒé£æ ¼çš„é‡å»ºç­–ç•¥é…ç½®ã€‚

---

**å®ç°å®Œæˆæ—¶é—´**ï¼š2025-06-29  
**å®ç°çŠ¶æ€**ï¼šâœ… å…¨éƒ¨å®Œæˆå¹¶éªŒè¯  
**å½±å“èŒƒå›´**ï¼šè¿é”å¤´å¯¸ç­–ç•¥åˆ›å»ºæµç¨‹  
**å…¼å®¹æ€§**ï¼šå‘åå®Œå…¨å…¼å®¹ 