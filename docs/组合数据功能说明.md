# 组合数据功能说明

## 📊 功能概述

在数据分析面板中新增了两条组合数据线，提供更丰富的数据分析维度：

1. **活跃Bin+5分钟收益率** - 展示活跃Bin百分比与短期收益率的组合表现
2. **活跃Bin+15分钟收益率** - 展示活跃Bin百分比与中期收益率的组合表现

## 🎯 设计理念

### 为什么要组合数据？
- **综合视角**：单独看活跃Bin百分比或收益率可能不够全面
- **趋势识别**：组合数据能更好地识别策略表现的变化趋势
- **决策支持**：提供更多维度的数据帮助策略调整决策

### 为什么起点设为100%？
- **统一基准**：与活跃Bin百分比的基准点保持一致
- **便于对比**：所有组合数据都从同一起点开始，便于横向对比
- **直观展示**：100%作为起点更符合百分比数据的直觉理解

## 🔧 技术实现

### 计算公式
```javascript
// 活跃Bin+5分钟收益率
combinedBin5m = activeBinPercentage + yieldRate5m

// 活跃Bin+15分钟收益率  
combinedBin15m = activeBinPercentage + yieldRate15m
```

### 数据类型配置
```javascript
{
    combinedBin5m: {
        label: '活跃Bin+5分钟收益率',
        color: '#06b6d4',  // 青色
        suffix: '%',
        amplify: 1,        // 不放大
        baseline: 100      // 起点100%
    },
    combinedBin15m: {
        label: '活跃Bin+15分钟收益率', 
        color: '#ec4899',  // 粉色
        suffix: '%',
        amplify: 1,        // 不放大
        baseline: 100      // 起点100%
    }
}
```

### 空值处理
- 当 `activeBinPercentage` 缺失时，自动设为 0
- 当 `yieldRate5m` 或 `yieldRate15m` 缺失时，自动设为 0
- 确保计算始终能够进行，不会因数据缺失而中断

## 📈 使用指南

### 在数据分析页面使用

1. **打开数据分析页面**
   - 访问系统主界面
   - 点击左侧菜单中的"数据分析"

2. **选择组合数据**
   - 在"选择数据类型"区域
   - 勾选"活跃Bin+5分钟收益率"
   - 勾选"活跃Bin+15分钟收益率"

3. **查看图表**
   - 组合数据以不同颜色的曲线显示
   - 起点都为100%
   - 可与其他数据类型进行对比

### 默认配置
新用户或清除保存数据后，系统默认会选择：
- 活跃Bin百分比
- 盈亏百分比  
- **活跃Bin+5分钟收益率** ✨
- **活跃Bin+15分钟收益率** ✨

## 🎨 视觉设计

### 颜色方案
- **活跃Bin+5分钟收益率**：`#06b6d4` (青色)
- **活跃Bin+15分钟收益率**：`#ec4899` (粉色)

这些颜色与现有数据类型的颜色有明显区分，确保用户能够清晰识别。

### 图例显示
```
🟢 活跃Bin百分比
🔵 活跃Bin+5分钟收益率  
🟡 活跃Bin+15分钟收益率
🔴 盈亏百分比 (20x)
```

## 📊 数据解读

### 组合数据的含义

**活跃Bin+5分钟收益率**：
- 反映短期内的综合表现
- 数值上升：活跃度提高或短期收益增加
- 数值下降：活跃度降低或短期收益减少

**活跃Bin+15分钟收益率**：
- 反映中期的综合表现  
- 相比5分钟数据更稳定
- 能够平滑短期波动，显示中期趋势

### 分析技巧

1. **趋势对比**
   - 观察两条组合线的走势差异
   - 5分钟线波动更大，15分钟线更平稳

2. **基准参考**
   - 100%为起点基准
   - 高于100%：综合表现良好
   - 低于100%：综合表现下降

3. **时间窗口选择**
   - 短期分析：选择1小时时间窗口
   - 中期分析：选择4小时时间窗口  
   - 长期分析：选择24小时时间窗口

## ⚙️ 技术特性

### 动态计算
- ✅ **实时计算**：基于现有数据动态计算，无需额外存储
- ✅ **内存友好**：不增加数据存储负担
- ✅ **性能优化**：计算简单，对系统性能影响极小

### 兼容性
- ✅ **向后兼容**：不影响现有数据类型
- ✅ **配置灵活**：可独立启用/禁用
- ✅ **扩展性强**：可轻松添加更多组合数据类型

### 错误处理
- ✅ **空值安全**：自动处理缺失数据
- ✅ **类型安全**：确保数值计算正确性
- ✅ **异常恢复**：计算错误不影响其他数据类型

## 🔮 未来扩展

基于此实现模式，未来可以轻松添加更多组合数据：

### 可能的扩展
- 活跃Bin+1小时收益率
- 活跃Bin+价格变化百分比
- 收益率+价格变化的组合
- 多重数据的加权组合

### 扩展方法
1. 在 `dataTypes` 中添加新配置
2. 在 `extractDataValue` 中添加计算逻辑
3. 设置合适的颜色和基准点
4. 可选：添加到默认选择中

## 📝 使用示例

### 示例场景：策略表现分析

假设某策略实例在某时刻的数据：
- 活跃Bin百分比：85%
- 5分钟收益率：+3.2%
- 15分钟收益率：+1.8%

**组合数据计算**：
- 活跃Bin+5分钟收益率：85 + 3.2 = 88.2%
- 活跃Bin+15分钟收益率：85 + 1.8 = 86.8%

**数据解读**：
- 5分钟组合数据：88.2%（相对基准100%下降11.8%）
- 15分钟组合数据：86.8%（相对基准100%下降13.2%）
- 说明该策略在这个时点的综合表现低于初始基准

## ✅ 验证测试

已通过完整的功能测试，包括：
- ✅ 计算公式正确性验证
- ✅ 空值处理测试
- ✅ 基准点设置验证
- ✅ 数据类型定义完整性检查

测试结果：**100%通过率** 🎉

---

*此功能提供了更丰富的数据分析维度，帮助用户更全面地了解策略表现。通过组合不同时间窗口的数据，为策略优化提供更多决策依据。* 